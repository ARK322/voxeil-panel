# DIFF REPORT
Timestamp: 2026-01-19T11:15:12+03:00
Branch: main
Commit: 5a14611965b1f5030842696b3b94d45482ec253a

## git diff --stat
 FINAL_CODE_SNAPSHOT.txt                   | 4915 -----------------------------
 README.md                                 |   17 +-
 apps/controller/src/http/routes.ts        |   15 +-
 apps/controller/src/k8s/namespace.ts      |   74 +-
 apps/controller/src/k8s/publish.ts        |   27 +-
 apps/controller/src/sites/site.dto.ts     |   26 +-
 apps/controller/src/sites/site.service.ts |  134 +-
 infra/k8s/platform/controller-deploy.yaml |    6 +-
 installer/installer.sh                    |   28 +
 9 files changed, 309 insertions(+), 4933 deletions(-)

## git diff (CONTROL_PLANE_DB_PLAN.md, README.md)
diff --git a/README.md b/README.md
index 5629346..767f9b1 100644
--- a/README.md
+++ b/README.md
@@ -8,6 +8,10 @@ Self-hosted, Kubernetes-native hosting control panel. API-first with a minimal U
 - `infra/k8s/platform`: k3s-compatible manifests with placeholders (`REPLACE_*`) for images and NodePorts.
 - `infra/k8s/templates/tenant`: Baseline ResourceQuota, LimitRange, and default-deny NetworkPolicy used for every tenant namespace.
 
+### Data model note
+- Control-plane DB: one shared PostgreSQL instance for controller state.
+- Tenant site DBs: per-site database + role/user inside a shared PostgreSQL "db zone".
+
 ### Install
 1) Build/push your own images (no hardcoded registry):
    - Controller: `apps/controller`
@@ -38,7 +42,16 @@ Self-hosted, Kubernetes-native hosting control panel. API-first with a minimal U
 - Creating a site provisions the namespace and immediately publishes a shared maintenance page.
 - Deployments happen only via `POST /sites/:slug/deploy` (manual).
 - Domains and subdomains are treated as separate sites (separate namespaces).
-- Ingress is HTTP-only for now; TLS is deferred to Phase 3.
+
+### Phase 3 TLS (cert-manager)
+- Install cert-manager from `infra/k8s/cert-manager/cert-manager.yaml` (pinned release).
+- Apply ClusterIssuers in `infra/k8s/cert-manager/cluster-issuers.yaml` after setting `REPLACE_LETSENCRYPT_EMAIL`.
+  - `letsencrypt-staging` uses the staging ACME endpoint.
+  - `letsencrypt-prod` uses the production ACME endpoint.
+- Enable TLS for new ingresses by setting:
+  - `TLS_ENABLED=true`
+  - `CERT_ISSUER_NAME=letsencrypt-staging` (or `letsencrypt-prod`)
+- TLS secret naming: `tls-<slug>` (per-site, deterministic).
 
 ### Security baseline
 - Controller enforces `X-API-Key` on all routes except `/health`.
@@ -46,7 +59,7 @@ Self-hosted, Kubernetes-native hosting control panel. API-first with a minimal U
 - Tenants get a dedicated namespace with ResourceQuota, LimitRange, and default-deny NetworkPolicy (DNS egress only).
 - Controller creates tenant Deployments, Services, and Ingress on site creation.
 - GHCR images are pulled via the `ghcr-pull-secret` copied into each tenant namespace.
-- TLS and cert-manager are not enabled yet; HTTP ingress only.
+- TLS is optional and controlled by controller env vars; HTTP ingress remains the default.
 
 ### Controller API
 - `POST /sites` with `{ domain, cpu, ramGi, diskGi }`
